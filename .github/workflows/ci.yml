name: Shell Script CI

on: 
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      # Kiểm tra mã nguồn của repo
      - name: Check out code
        uses: actions/checkout@v2
        
      # Cài đặt shellcheck để kiểm tra lỗi shell script
      - name: Set up shellcheck
        run: sudo apt-get install -y shellcheck
        
      # Kiểm tra mã shell với shellcheck để phát hiện lỗi cú pháp
      - name: Run ShellCheck on changed files
        run: |
          CHANGED_FILES=$(git diff --name-only HEAD^ HEAD | grep '\.sh$' || true)
          for FILE in $CHANGED_FILES; do
            echo "Running shellcheck on $FILE"
            shellcheck "$FILE"
          done

      # Thực thi script với Bash (khi có lỗi, quá trình sẽ dừng lại)
      - name: Execute script with Bash
        run: |
          set -e
          CHANGED_FILES=$(git diff --name-only HEAD^ HEAD | grep '\.sh$' || true)
          for FILE in $CHANGED_FILES; do
            echo "Executing $FILE with Bash"
            bash "$FILE"
          done
